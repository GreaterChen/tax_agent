# 高级网页搜索工具 (Advanced Web Search Tool)

## 功能概述

这是一个专门针对税务领域的高级网页搜索工具，支持多语言（中文、英文）搜索和内容处理。该工具主要用于从指定的税务相关网站获取信息，并通过智能处理提供准确的搜索结果。

## 默认信息源

工具默认从以下权威网站搜索信息：
- ACCA官网 (accaglobal.com/hk)
- HKICPA官网 (hkicpa.org.hk)
- 香港税务局官网 (ird.gov.hk/eng)
- 国家税务总局官网 (chinatax.gov.cn/chinatax/)

## 处理流程

### 1. 查询预处理
1. 接收用户原始查询
2. 使用 LLM 生成多组搜索查询词
   - 提取核心概念和关键词
   - 使用同义词扩展
   - 针对不同角度生成特定查询

### 2. 搜索执行
1. 使用 Google Custom Search API 执行搜索
2. 对每个生成的查询词进行搜索
3. 结果去重和初步过滤

### 3. 内容获取和处理

#### 3.1 PDF文档处理
1. 使用 PyPDFLoader 加载PDF内容
2. 使用 RecursiveCharacterTextSplitter 分割文档
3. 混合检索（Hybrid Retrieval）
   - 余弦相似度计算（60%权重）
     * 使用 multilingual-e5-large 模型生成向量
     * 计算查询与文档片段的相似度
   - BM25检索（40%权重）
     * 对文档进行分词
     * 计算词频相关性
   - 归一化和加权合并两种分数
4. 返回最相关的文本片段

#### 3.2 网页内容处理
1. 使用 BeautifulSoup 清理HTML内容
   - 移除无关元素（脚本、样式、导航等）
   - 提取纯文本内容
2. 文本规范化
   - 去除多余空白
   - 限制文本长度（最大50000字符）
3. 直接返回处理后的文本内容

### 4. 结果分析和生成
1. 将所有来源的内容转换为文档格式
2. 提取元数据（标题、URL、摘要等）
3. 使用 LLM 分析内容并生成回答
   - 直接回答用户问题
   - 综合多个来源的信息
   - 提供信息来源引用
   - 标注不同来源的冲突信息
   - 指出信息不足的情况

## 特殊功能

### 多语言支持
- 自动检测查询语言
- 根据语言选择适当的处理策略
- 支持中文（简体/繁体）和英文

### 缓存机制
- 搜索结果缓存
- 网页内容缓存
- 避免重复请求相同资源

### 错误处理
- 网络请求超时处理
- 无效页面检测
- 格式转换异常处理

## 依赖项
- langchain：核心框架
- zhipuai/dashscope：LLM服务
- beautifulsoup4：HTML处理
- PyPDF2：PDF处理
- rank_bm25：BM25算法实现
- scikit-learn：余弦相似度计算
- numpy：数值计算
- spacy：文本处理
- HuggingFace transformers：文本嵌入

## 配置要求
- Google Custom Search API 密钥
- 通义千问/智谱AI API 密钥
- Spacy 语言模型（en_core_web_sm, zh_core_web_sm）

## 使用限制
- 每个检索词最大返回结果数：3
- 最大处理PDF页数：无限制
- 单个网页文本长度限制：50000字符
- 需要网络连接访问外部API和网站
